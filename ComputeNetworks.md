[TOC]

# 版权声明

- 计算机网络系列学习笔记来源于以下资料：
  - James F. Kurose 和 Keith W. Ross 的著作《计算机网络——自顶向下方法》第6版 [1]；
  - 李全龙副教授和聂兰顺副教授在中国大学MOOC网站上所授课程计算机网络 [2]；
- 该系列笔记不以盈利为目的，仅用于个人学习、课后复习及科学研究；
- 如有侵权，请与本人联系（hqpan@foxmail.com），经核实后即刻删除；
- 本文采用 [署名-非商业性使用-禁止演绎 4.0 国际 (CC BY-NC-ND 4.0)](https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh) 协议发布；

# 1. 计算机网络概述

## 1.1 基本概念

- host/end systems：主机/端系统，通过通信链路和分组交换机实现互联；
  - 客户机；
  - 服务器；
- ISP：Internet service provider；
- LAN：Local Area Network，局域网；
- RFC：Request for Comments，请求评议文档，定义公开协议；
- 以太网：ethernet，一种目前应用最广泛的局域网技术；



## 1.2 网络结构

- 计算机网络结构：
  - 网络边缘：
    - 主机/端系统：每个端系统有一个 IP 地址；
      - client-server 模型；
      - peer-peer (P2P) 模型；
    - 接入网：将端系统连接到边缘路由器的物理链路；
      - 带宽：bandwidth，bps；
      - 共享/独占；
  - 网络核心：分组转发设备；
- 常见的接入网络：
  - DSL & ADSL：
    - DSL： Digital Subscriber Line，数字用户线，使用 FDM（频分复用），借助已有的电话线连接至中心局；
    - ADSL： Asymmetric Digital Subscriber Line，非对称数字用户线路；
      - 下行传输速率高于上行传输速率；
      - 用户独占接入网络；
  - HFC：Hybrid Fiber Coax，混合光纤同轴电缆网；
    - 下行传输速率高于上行传输速率；
    - 用户共享接入网络；
  - 无线接入网络：
    - 无线局域网：LANs，同一建筑物内；
    - 广域无线接入：通过电信运营商，接入范围约为几十公里；



## 1.3 网络核心

- 网络核心的功能：路由（routing）、转发；
- 网络核心解决的基本问题：数据交换，将数据从源主机送达目的主机；
  - 转发表：每台路由器具有一个转发表，将目的地址（或目的地址的一部分）映射为输出链路；
  - 路由选择协议：自动设置转发表；
- 数据交换的类型：
  - 电路交换：独占频带资源，E.g. 电话网络；
    - 建立连接；
    - 通信；
    - 释放连接；
  - 报文交换：采用存储转发方式；
  - 分组交换：采用存储转发方式，需要拆分、重组报文；
    - 分组：将报文拆分为较小的数据包，并加上头部信息；
- 分组交换相较于电路交换的优缺点：
  - 优点：
    - 简单可用，无需建立连接、拆除连接；
    - 适用于传输突发数据，共享频带资源，允许更多用户同时使用网络；
  - 缺点：可能产生拥塞，导致分组延迟和丢失，需要协议加以控制；
- 分组交换相较于报文交换的优势：
  - 分组交换对路由器的缓存要求低；
  - 分组交换中，通信链路上的路由器可以并行转发分组，传输延迟更小；
- 多路复用方法：
  - FDM：频分复用；
  - TDM：时分复用；
  - WDM：波分复用，在光通信中，根据光的波长不同实现信道复用，本质上是 FDM；
  - CDM：码分复用，各用户的码片序列正交；



## 1.4 网络性能

### 1.4.1 衡量网络性能的指标

- 衡量网络性能的指标：
  - 速率；
  - 带宽：在计算机网络中，指数字信道的最高传输速率，单位为 bps；
  - 时延；
  - 时延带宽积；
  - 丢包率；
  - 吞吐量：路由器转发分组的速率；



### 1.4.2 时延

- 流量强度：$\frac{La}{R}$；
  - L：分组长度 L 比特；
  - a：分组到达路由器的速率，单位为**分组/秒**；
  - R：传输速率；
- 时延：
  - 处理时延：通常为微秒数量级；
    - 检查分组首部，确定输出链路；
    - 检查传输错误；
  - 排队时延；
    - 若流量强度趋近于0，则排队时延趋近于0；
    - 若流量强度趋近于1，则排队时延趋近于无穷；
    - 若流量强度趋大于1，则发生丢包；
  - 传输时延：$传输延迟=\frac{分组长度}{链路带宽}$；
  - 传播时延：$传播延迟=\frac{物理链路长度}{信号传播速度}$；
- 时延带宽积：
  - $时延带宽积(bit)=传播时延(s)\times带宽(bit/s)​$；
  - 含义：当第一个bit的信息到达信宿后，链路中所有信息的比特数，即链路中能容纳的比特数，又称以比特为单位的链路长度；



### 1.4.3 丢包 和吞吐量

- 丢包：
  - 路由器缓存容量有限，若分组到达已满队列，则发生丢包；
  - 由前序节点或源节点重发，也可能不重发；
  - $丢包率=\frac{丢包数}{已发分组总数}​$；
- 端到端吞吐量：发送端与接收端之间的传输速率，取决于瓶颈链路；
  - 瞬时吞吐量；
  - 平均吞吐量；



## 1.5 计算机网络的体系结构

### 1.5.1 基本概念

- ISO：International Organization for Standardization，国际标准化组织；
- OSI：Open System Interconnect，开放系统互连模型，是一种分层网络体系结构模型；
- PDU：Protocol Data Unit，协议数据单元，OSI 模型中的每一层都将建立协议数据单元，附加到数据中；
- SAP：Service Access Point，服务访问点，同一系统中相邻层实体间通过接口交换原语，指定服务内容； 
- 各层中分组的称谓：
  - 协议栈：各层所有协议的总称；
  - 报文：message，应用层的信息分组；
  - 报文段：segment，运输层的信息分组；
  - 数据报：datagram，网络层的信息分组；
  - 帧：frame，链路层的分组；
- 分组中具有两种类型的字段：
  - 首部字段；
  - 有效载荷字段；



### 1.5.2 协议层次

- 5层因特网协议栈：
  - 应用层：支持各种网络应用，FTP、SMTP、HTTP；
    - DNS：域名解析；
    - FTP：2个端系统间文件传输；
    - HTTP：Web 文档的请求和传送；
    - SMTP：电子邮件报文传输；
  - 运输层：进程间数据传输，TCP、UDP；
  - 网络层：源主机到目的主机的数据分组路由与转发，IP协议、路由选择协议；
  - 链路层：相邻网络元素（主机、交换机、路由器）的数据传输；
  - 物理层：比特传输；
- 7层 OSI 模型：
  - 应用层；
  - 表示层：使通信的应用程序能解释交换数据的含义，提供数据压缩、数据加密和数据描述；
  - 会话层：提供数据交换定界和同步功能；
  - 运输层；
  - 网络层；
  - 数据链路层；
  - 物理层；
- 分组交换机：
  - 链路层交换机：
    - 常用于接入网；
    - 实现2个层次：物理层和链路层；
    - 不能识别 IP 地址，但能识别以太网地址；
  - 路由器：
    - 常用于网络核心；
    - 实现3个层次：物理层、链路层和网络层；



### 1.5.3 网路中各层的功能

- 数据链路层的功能：负责节点间的数据传输；
  - 组帧；
  - 物理寻址；
  - 流量控制；
  - 差错控制；
  - 访问（接入）控制；
- 网络层的功能：从源主机到目的主机数据分组交付；
  - 逻辑寻址；
  - 路由；
  - 分组转发；
- 运输层的功能：端到端之间完整的报文传输；
  - 分段与重组；
  - SAP 寻址；
  - 连接控制；
  - 流量控制；
  - 差错控制；
- 会话层的功能：
  - 对话控制；
  - 同步；
- 表示层的功能：两个系统间交换信息的语法和语义；
  - 数据表示转换；
  - 加密/解密；
  - 压缩/解压；
- 应用层的功能：支持用户通过用户代理或网络接口使用网络服务；



# 2. 网络应用

## 2.1 网络应用的基本原理

- 网络应用的体系结构：
  - 客户机/服务器结构：Client-Server (C/S)，客户机之间不直接通讯；
  - P2P结构：任意端系统之间可直接通讯；
    - 优点：高度可伸缩；
    - 缺点：不易管理；
  - 混合结构；
- 进程间通信：
  - 同一主机上不同进程间通信：操作系统提供进程间通信机制；
  - 不同主机上不同进程间通信：消息交换，使用socket发送/接收消息；
- 进程的标识符：IP 地址 + 端口号；
  - IP 地址：寻址主机；
  - 端口号：为主机上每个需要通信的进程分配端口号；
- 网络应用对传输服务的要求：
  - 可靠性（防数据丢失）；
  - 时延；
  - 带宽；
- Internet 传输服务模型：TCP、UDP；
  - 面向连接：客户机-服务器进程间需要建立连接；
  - 可靠传输：防数据丢失；
  - 流量控制：发送方的发送速度不超过接收方的处理能力；
  - 拥塞控制：当网络负载过重时，限制发送方的速度；

|   传输服务    | TCP  | UDP  |
| :-----------: | :--: | :--: |
|   面向连接    |  T   |  F   |
|   可靠传输    |  T   |  F   |
|   流量控制    |  T   |  F   |
|   拥塞控制    |  T   |  F   |
| 时间/延迟保障 |  F   |  F   |
| 最小带宽保障  |  F   |  F   |



## 2.2 Web 应用

### 2.2.1 HTTP 连接类型

- World Wide Web：应用层协议为 HTTP；
  - 网页间相互链接；
  - 网页包含多个对象；
    - HTML 文件包含引用对象的链接；
    - 对象寻址：URL (Uniform Resource Locator)，统一资源定位器；
- HTTP 协议：Hyper Text Transfer Protocol，超文本传输协议；
  - 无状态协议：服务器不维护客户端此前发送的请求信息；
  - 传输层协议为 TCP；
  - 请求/响应交互模式；
- HTTP 连接的类型：
  - 非持久性连接：
    - HTTP 1.0 版本；
    - 每个 TCP 连接至多允许传输一个对象；
    - 缺点：若有多个对象需要传输，则需多次建立 TCP 连接，时间开销大；
  - 持久性连接：HTTP 1.1 版本，每个 TCP 连接允许传输多个对象；
    - 无流水线机制的持久性连接：
      - 仅当客户端收到前一个响应后，才发送新的请求；
      - 每个被引用对象耗时1 RTT；
    - 流水线机制的持久性连接：
      - 客户端遇到一个引用对象，则立即发出请求；
      - 理想状态下，收到所有引用对象仅耗时1 RTT；
- RTT：Round Trip Time，客户端向服务器发送一个较小的数据包并返回所需时间；
- $响应时间=2RTT+文件传输时间$；
  - 建立 TCP 连接：1 RTT；
  - 发送 HTTP 请求、接收到 HTTP 响应消息的前几个字节：1 RTT；
  - 响应消息中的文件传输时间；



### 2.2.2 HTTP 消息格式

- HTTP 请求消息格式：
  - 请求行：request line；
  - 头部行：header line；
- HTTP 响应消息格式：
  - 状态行；
  - 头部行；
- HTTP 响应状态代码：

| 响应状态代码 |            含义            |
| :----------: | :------------------------: |
|     200      |             OK             |
|     301      |     Moved Permanently      |
|     304      |        Not Modified        |
|     400      |        Bad Request         |
|     404      |         Not Found          |
|     505      | HTTP Version Not Supported |



### 2.2.3 Cookie 技术

- Cookie 技术：用于辨别用户身份，将数据加密后存储在用户本地；
- Cookie 组件：
  - HTTP 响应消息的 Cookie 头部行；
  - HTTP 请求消息的 Cookie 头部行；
  - 保存在客户端主机上的 Cookie 文件，由浏览器管理；
  - Web 服务器端的后台数据库；



### 2.2.4 Web 缓存

- Web 缓存/代理服务器：架设在 origin server 和 client 之间，既充当客户端，又充当服务器；
- 使用条件性 GET 方法，将缓存服务器中的数据更新到最新版本；



## 2.3 Email 应用

### 2.3.1 Email 应用概述

- Email 应用的构成组件：
  - 邮件客户端：user agent；
  - 邮件服务器；
  - SMTP 协议：Simple Mail Transfer Protocol；
    - 客户端：发送消息的服务器；
    - 服务器：接收消息的服务器；



### 2.3.2 SMTP 协议

- SMTP 协议：Email 消息传输协议；
  - 传输层协议使用 TCP 协议；
  - 传输的阶段：握手、消息传输、关闭；
  - 命令/响应交互模式；
- 邮件访问协议：access protocol，从服务器获取邮件；
  - POP：Post Office Protocol；
  - IMAP：Internet Mail Access Protocol；
  - HTTP；
- POP：
  - 认证阶段：
    - 客户端命令：用户名和密码；
    - 服务器响应；
  - 事务阶段；



## 2.4 DNS 应用

- DNS：域名解析系统，实现域名和 IP 地址之间的映射；
  - 根服务器：本地域名服务器无法解析域名时，访问根服务器；
  - 顶级域名服务器：顶级域名、国家名；
  - 权威域名服务器：组织域名；
- 本地域名解析服务器：不严格属于 DNS；
  - 每个 ISP 均有一个本地域名解析服务器；
  - 缓存顶级域名服务器的映射；



## 2.5 P2P 应用

- P2P 索引技术：
  - 集中式索引：单点失效、瓶颈问题；
  - 泛洪查询：大量消耗网络带宽，导致网络拥塞；
    - 分布式架构，每个节点仅对该节点共享的文件进行索引；
    - 查询消息通过已有的 TCP 连接发送给相邻节点；
  - 层次式覆盖网络：介于集中式索引和泛洪查询之间；
    - 节点和超级节点之间存在 TCP 连接；
    - 超级节点之间存在 TCP 连接；
    - 超级节点跟踪子节点的内容，并为子节点提供索引；



## 2.6 Socket 编程

- Socket API：套接字接口；
  - socket，n. 插座；
  - 介于应用层和传输层之间；
  - 区分不同的套接字：
    - 对外：使用 IP 地址 + 端口号；
    - 对内：使用套接字描述符；



# 3. 传输层

## 3.1 传输层服务

- 传输层：
  - 为不同主机上的进程提供逻辑通信机制；
  - 将应用层提供的消息分成多个 segment，交给网络层；
- 网络层：提供主机之间的逻辑通信机制；



## 3.2 复用和分用

- 多路复用、多路分用：
  - 多路复用：传输层通过多个 Socket 从应用层接收数据，为每块数据封装上头部信息，生成 Segment，交给网络层；
  - 多路分用：传输层根据头部信息，将接收到的 Segment 通过对应的 Socket 交给不同进程；
- 面向连接的分用、无连接的分用：
  - 面向连接的分用：
    - Socket 标识：  (源IP，源端口号，目的IP，目的端口号)；
    - 服务器支持多个 TCP 连接，为每个客户端提供不同的 Socket；
  - 无连接的分用：
    - Socket 标识：  (目的IP，目的端口号)；



## 3.3 UDP

- UDP：User Datagram Protocol；
  - 基于 Internet IP 协议；
  - 复用/分用；
  - 校验和：checksum，提供简单的错误校验；
  - 可在应用层增加可靠性机制，实现可靠数据传输；
- UDP 的优缺点：
  - 优点：
    - 头部开销小；
    - 延迟少：无需建立连接；
    - 实现简单：无需维护连接；
    - 便于应用控制发送时间和速率：无拥塞控制机制；
  - 缺点：数据非按序到达；
- UDP 的应用范围：对速度要求高，但对数据丢失不明感的应用；
  - 流媒体；
  - DNS；
  - SNMP；



# 待整理内容

- TCP/IP 协议：
  - TCP：Transmission Control protocol，传输控制协议；
  - IP ：Internet protocol，网际协议，定义路由器和端系统间收发分组的格式；
- TCP/IP 模型：
  - 应用层；
  - 运输层；
  - 网际层；
  - 网络接口层；



# ==Schedule==

- 教材：
  - 起始时间：2020年02月08日；
  - 每次10页，38次完成全部内容；
  - 课程进度：Page 38， 1.5 已完成；
- 视频：
  - 起始时间：2020年02月03日；
  - 2月配合教材进度完成全部内容；
  - 课程进度：3.4 已完成；
- 教材与视频内容整合：1.5 已完成；



# References

[1] Kurose, F. J, Ross, K. W. 计算机网络自顶向下方法[M]. 北京: 机械工业出版社, 2014.
[2] https://www.icourse163.org/learn/HIT-154005?tid=1206679208#/learn/announce.


